# ‚òï –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ (Tilda + iikoCard)

[üá∫üá∏ English Version](README.md)

> **–ì–æ—Ç–æ–≤–æ–µ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É —Ä–µ—à–µ–Ω–∏–µ (Middleware)**, —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–µ –¥–ª—è —Å–µ—Ç–∏ –∫–æ—Ñ–µ–µ–Ω (4 —Ç–æ—á–∫–∏) –≤ –ê–ª–º–∞—Ç—ã.
> –û—Ä–∫–µ—Å—Ç—Ä–∏—Ä—É–µ—Ç –ø–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º (Tilda), –¥–≤–∏–∂–∫–æ–º –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ (iikoCard) –∏ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞–º–∏.

![n8n](https://img.shields.io/badge/n8n-Workflow_Automation-orange?style=flat-square)
![JavaScript](https://img.shields.io/badge/JavaScript-ES6-yellow?style=flat-square)
![SQL](https://img.shields.io/badge/SQL-Analytics-blue?style=flat-square)
![Status](https://img.shields.io/badge/Status-Production-success?style=flat-square)

---

## üì∏ –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã

### 1. –†–µ–∑—É–ª—å—Ç–∞—Ç (Frontend –∏ UI –ê–¥–º–∏–Ω–∞)
–ö–∞—Å—Ç–æ–º–Ω—ã–µ JS-—Å–∫—Ä–∏–ø—Ç—ã –ø–æ–∑–≤–æ–ª—è—é—Ç –∫–ª–∏–µ–Ω—Ç–∞–º –ø—Ä–æ–≤–µ—Ä—è—Ç—å –±–∞–ª–∞–Ω—Å. –ê–¥–º–∏–Ω—ã –ø–æ–ª—É—á–∞—é—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∏ –º–æ–≥—É—Ç **–æ—Ç–º–µ–Ω—è—Ç—å –∑–∞–∫–∞–∑—ã** –ø—Ä—è–º–æ –∏–∑ Telegram.

| UI –ö–ª–∏–µ–Ω—Ç–∞ (Tilda) | –ê–ª–µ—Ä—Ç –ê–¥–º–∏–Ω–∞ (Telegram) |
| :---: | :---: |
| <img src="assets/tilda-frontend-ui.png" width="400" alt="Tilda UI"> | <img src="assets/telegram-alert.png" width="300" alt="New Order"><br><br>‚¨áÔ∏è *–ü–æ—Å–ª–µ –æ—Ç–º–µ–Ω—ã* ‚¨áÔ∏è<br><br><img src="assets/telegram-alert-cancel.png" width="300" alt="Order Cancelled"> |

### 2. "–ú–æ–∑–≥" —Å–∏—Å—Ç–µ–º—ã (–ë—ç–∫–µ–Ω–¥ –ª–æ–≥–∏–∫–∞)
–°–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å, –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ä–∞—Å—á–µ—Ç—ã (–Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ 5% / —á–∞—Å—Ç–∏—á–Ω–æ–µ —Å–ø–∏—Å–∞–Ω–∏–µ) –∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é API.

![Workflow Overview](assets/workflow-overview.png)
*–û—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ—Ü–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–∫–∞–∑–∞ (n8n)*

---

## üöÄ –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

*   **üõ°Ô∏è –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –∏ –∑–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–µ–π:** –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –¥–≤–æ–π–Ω—ã–µ —Å–ø–∏—Å–∞–Ω–∏—è –ø—É—Ç–µ–º –ø—Ä–æ–≤–µ—Ä–∫–∏ —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ `order_id` –ø–æ –±–∞–∑–µ Google Sheets –ø–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π.
*   **üîå –ü–∞—Ç—Ç–µ—Ä–Ω API Gateway:** –§—Ä–æ–Ω—Ç–µ–Ω–¥ (Tilda) –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –æ–±—â–∞–µ—Ç—Å—è —Å –±—ç–∫–µ–Ω–¥–æ–º (iiko) –Ω–∞–ø—Ä—è–º—É—é. n8n –≤—ã—Å—Ç—É–ø–∞–µ—Ç –≤ —Ä–æ–ª–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –ø—Ä–æ–∫—Å–∏, —Å–∫—Ä—ã–≤–∞—è API-–∫–ª—é—á–∏.
*   **üö® –ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:** –û—Ç–¥–µ–ª—å–Ω—ã–π "Watchdog" –≤–æ—Ä–∫—Ñ–ª–æ—É –ª–æ–≤–∏—Ç –æ—à–∏–±–∫–∏ 4xx/5xx, –ª–æ–≥–∏—Ä—É–µ—Ç –∏—Ö –≤ –ë–î –∏ –∞–ª–µ—Ä—Ç–∏—Ç DevOps-–∫–æ–º–∞–Ω–¥—É.
*   **üîÑ –û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å:** HTTP-–∑–∞–ø—Ä–æ—Å—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ø–æ–ª–∏—Ç–∏–∫—É `3x Retry` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–±–æ–µ–≤ —Å–µ—Ç–∏.
*   **üíª –ö–∞—Å—Ç–æ–º–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞:** Vanilla JS —Å–∫—Ä–∏–ø—Ç—ã (—Å–º. [`docs/`](docs/)), –≤–Ω–µ–¥—Ä–µ–Ω–Ω—ã–µ –≤ Tilda –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–∞–ª–∞–Ω—Å–∞.

---

## üß™ –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å –¥–µ–º–æ

–ü–æ—Å–∫–æ–ª—å–∫—É —ç—Ç–æ –±—ç–∫–µ–Ω–¥-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è, –≤—ã –º–æ–∂–µ—Ç–µ —Å–∏–º—É–ª–∏—Ä–æ–≤–∞—Ç—å —Ç—Ä–∏–≥–≥–µ—Ä—ã —á–µ—Ä–µ–∑ **Postman** –∏–ª–∏ **cURL**.

*   **–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ:** –ü–æ–ª–Ω—ã–µ JSON-–ø—Ä–∏–º–µ—Ä—ã (–∑–∞–∫–∞–∑—ã Tilda, –∫–æ–ª–±—ç–∫–∏ Telegram) –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –ø–∞–ø–∫–µ [`sample_payloads/`](sample_payloads/).
*   **–ó–∞–ø—É—Å–∫:** –û—Ç–ø—Ä–∞–≤—å—Ç–µ `POST` –∑–∞–ø—Ä–æ—Å –Ω–∞ –≤–µ–±—Ö—É–∫ n8n, –∏—Å–ø–æ–ª—å–∑—É—è –¥–∞–Ω–Ω—ã–µ –∏–∑ —ç—Ç–∏—Ö —Ñ–∞–π–ª–æ–≤.

### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
1.  n8n –ø—Ä–æ–≤–µ—Ä—è–µ—Ç Google –¢–∞–±–ª–∏—Ü—É (—Å–º. —Å–∫—Ä–∏–Ω –ª–æ–≥–æ–≤: [`assets/execution-logs.png`](assets/execution-logs.png)).
2.  –ï—Å–ª–∏ `orderid` –Ω–æ–≤—ã–π ‚Üí –°—á–∏—Ç–∞–µ—Ç 5% –±–∞–ª–ª–æ–≤ ‚Üí –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ iiko ‚Üí –£–≤–µ–¥–æ–º–ª—è–µ—Ç –ê–¥–º–∏–Ω–∞.
3.  –ï—Å–ª–∏ `orderid` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç ‚Üí –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ (–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å).

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

### –í–æ—Ä–∫—Ñ–ª–æ—É (n8n JSON)

| –í–æ—Ä–∫—Ñ–ª–æ—É | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-------------|
| [`01_order_processing_tilda.json`](01_order_processing_tilda.json) | **–û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞.** –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –≤–µ–±—Ö—É–∫, –∏—â–µ—Ç –¥—É–±–ª–∏, —Å—á–∏—Ç–∞–µ—Ç –±–∞–ª–ª—ã, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç —Å iiko |
| [`02_customer_balance_check.json`](02_customer_balance_check.json) | **–ü—Ä–æ–∫—Å–∏ API.** –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–ª–∞–Ω—Å" —Å —Å–∞–π—Ç–∞ |
| [`03_admin_refund_handler.json`](03_admin_refund_handler.json) | **–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –ê–¥–º–∏–Ω–∞.** –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–ª–∏–∫–∏ "–û—Ç–º–µ–Ω–∞ –∑–∞–∫–∞–∑–∞", –∞–Ω–Ω—É–ª–∏—Ä—É–µ—Ç –±–∞–ª–ª—ã, –æ–±–Ω–æ–≤–ª—è–µ—Ç –ë–î |
| [`99_global_error_handler.json`](99_global_error_handler.json) | **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥.** –õ–æ–≤–∏—Ç –ø–∞–¥–µ–Ω–∏—è –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ |

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (`/docs`)
*   [üìÑ ARCHITECTURE.md](docs/ARCHITECTURE.md) ‚Äî –°—Ö–µ–º–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –∏ –ø–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö.
*   [üîå Integrations & API](docs/integrations.md) ‚Äî –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è API –∏ Payloads.
*   [üîê Security](docs/security.md) ‚Äî –ö–∞–∫ –∑–∞—â–∏—â–µ–Ω—ã —Å–µ–∫—Ä–µ—Ç—ã –∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.
*   [üìñ Runbook](docs/RUNBOOK.md) ‚Äî –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—é –Ω–µ–ø–æ–ª–∞–¥–æ–∫.
*   [üìä SQL Examples](docs/sql_examples.md) ‚Äî –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã.
*   [üíª Frontend Scripts](docs/) ‚Äî JS-–∫–æ–¥, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –≤ Tilda.

---

## üõ† –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

1.  **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
    –ü–µ—Ä–µ–∏–º–µ–Ω—É–π—Ç–µ [`ENV.example`](ENV.example) –≤ `.env` –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ API-–∫–ª—é—á–∏.
    *   *–í–∞–∂–Ω–æ: –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–µ –∫–ª—é—á–∏ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.*

2.  **Credentials (OAuth2):**

| –°–µ—Ä–≤–∏—Å | –ù–∞—Å—Ç—Ä–æ–π–∫–∞ |
|---------|-------|
| **Google Sheets:** | –°–æ–∑–¥–∞–π—Ç–µ –∫—Ä–µ–¥—ã "Google Sheets OAuth2 API" –≤ n8n, –∏—Å–ø–æ–ª—å–∑—É—è –≤–∞—à–∏ `Client ID` –∏ `Secret` |
| **Telegram:** | –î–æ–±–∞–≤—å—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –≤ Credentials n8n |

3.  **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Tilda:**
    –í—Å—Ç–∞–≤—å—Ç–µ —Å–∫—Ä–∏–ø—Ç [`docs/tilda-checkout-integration.js`](docs/tilda-checkout-integration.js) –≤ footer-–∫–æ–¥ —Å—Ç—Ä–∞–Ω–∏—Ü—ã Tilda.

---

### üë§ –ê–≤—Ç–æ—Ä

**–ì—É–ª—å–Ω–∞–∑ –ë–∞–∫–∏–Ω–æ–≤–∞**

*–ò–Ω–∂–µ–Ω–µ—Ä –ø–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è–º –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ (n8n / Low-code)*

–ë—É–¥–µ–º –Ω–∞ —Å–≤—è–∑–∏!
[LinkedIn](https://www.linkedin.com/in/gulnaz-bakinova/)
